library(ggplot2)
library(reshape)
library(raster)
brt <- "L:/Boreal/DensityModelsV6/brt/cv/"
speclist <- read.csv("I:/BAM/BAMData/SpeciesClassesModv5.csv")
speclistB <- speclist[speclist$Boreal==1,c(1,4)]
speclistB <- as.factor(as.character(speclistB[1:74,1]))


dcurr <- raster(paste(brt,speclistB[1],"_currmean.asc",sep=""))
d2020 <- raster(paste(brt,speclistB[1],"_2020mean.asc",sep=""))
d2050 <- raster(paste(brt,speclistB[1],"_2050mean.asc",sep=""))
d2080 <- raster(paste(brt,speclistB[1],"_2080mean.asc",sep=""))
pcurr <- raster(paste(brt,speclistB[1],"_pres_currmean.asc",sep=""))
p2020 <- raster(paste(brt,speclistB[1],"_pres_2020mean.asc",sep=""))
p2050 <- raster(paste(brt,speclistB[1],"_pres_2050mean.asc",sep=""))
p2080 <- raster(paste(brt,speclistB[1],"_pres_2080mean.asc",sep=""))	
BC2020p <- abs(pcurr-p2020)/(pcurr+p2020)
BC2050p <- abs(pcurr-p2050)/(pcurr+p2050)
BC2080p <- abs(pcurr-p2080)/(pcurr+p2080)
BC2020d <- abs(dcurr-d2020)/(dcurr+d2020)
BC2050d <- abs(dcurr-d2050)/(dcurr+d2050)
BC2080d <- abs(dcurr-d2080)/(dcurr+d2080)
for (j in 2:length(speclistB)) {
	dcurr <- raster(paste(brt,speclistB[j],"_currmean.asc",sep=""))
	d2020 <- raster(paste(brt,speclistB[j],"_2020mean.asc",sep=""))
	d2050 <- raster(paste(brt,speclistB[j],"_2050mean.asc",sep=""))
	d2080 <- raster(paste(brt,speclistB[j],"_2080mean.asc",sep=""))
	pcurr <- raster(paste(brt,speclistB[1],"_pres_currmean.asc",sep=""))
	p2020 <- raster(paste(brt,speclistB[j],"_pres_2020mean.asc",sep=""))
	p2050 <- raster(paste(brt,speclistB[j],"_pres_2050mean.asc",sep=""))
	p2080 <- raster(paste(brt,speclistB[j],"_pres_2080mean.asc",sep=""))	
	BC2020p <- BC2020p + (abs(pcurr-p2020)/(pcurr+p2020))
	BC2050p <- BC2050p + (abs(pcurr-p2050)/(pcurr+p2050))
	BC2080p <- BC2080p + (abs(pcurr-p2080)/(pcurr+p2080))
	BC2020d <- BC2020d + (abs(dcurr-d2020)/(dcurr+d2020))
	BC2050d <- BC2050d + (abs(dcurr-d2050)/(dcurr+d2050))
	BC2080d <- BC2080d + (abs(dcurr-d2080)/(dcurr+d2080))	
	}

writeRaster(BC2020p, file=paste(brt,"_BC2020p.asc",sep=""), format="ascii", overwrite=TRUE)
png(paste(brt,"_BC2020p.png",sep=""))
plot(BC2020p)
dev.off()

writeRaster(BC2050p, file=paste(brt,"_BC2050p.asc",sep=""), format="ascii", overwrite=TRUE)
png(paste(brt,"_BC2050p.png",sep=""))
plot(BC2050p)
dev.off()

writeRaster(BC2080p, file=paste(brt,"_BC2080p.asc",sep=""), format="ascii", overwrite=TRUE)
png(paste(brt,"_BC2080p.png",sep=""))
plot(BC2080p)
dev.off()

writeRaster(BC2020d, file=paste(brt,"_BC2020d.asc",sep=""), format="ascii", overwrite=TRUE)
png(paste(brt,"_BC2020d.png",sep=""))
plot(BC2020d)
dev.off()

writeRaster(BC2050d, file=paste(brt,"_BC2050d.asc",sep=""), format="ascii", overwrite=TRUE)
png(paste(brt,"_BC2050d.png",sep=""))
plot(BC2050d)
dev.off()

writeRaster(BC2080d, file=paste(brt,"_BC2080d.asc",sep=""), format="ascii", overwrite=TRUE)
png(paste(brt,"_BC2080d.png",sep=""))
plot(BC2080d)
dev.off()